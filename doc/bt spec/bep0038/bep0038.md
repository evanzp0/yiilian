# Finding Local Data Via Torrent File Hints (通过种子文件的提示找到局部数据)

## 摘要

内容提供商经常会分发包含部分相同文件的种子文件。这种情况在分发连续剧内容或定期更新的内容时最为常见。
目前，当用户下载某个种子(中的内容)时，无论他们是否已通过其他种子下载过其中的文件，都必须下载该种子内的所有文件。
此扩展功能允许内容提供商在种子文件中包含提示，使客户端能够轻松判断用户已经拥有哪些文件。

## 概述

嵌入在种子文件中的提示有两种形式‌：

- The Info Hash Variety (info hash 的变体)

种子文件中可能有一个 `similar` 键，其值是一个以二进制字符串形式存储的 info hash 列表。这些 info hash 可用于识别可能共享(内部)文件的种子文件。

- The Collection Variety (collection 的变体)

种子文件中可能有一个 `collections` 键，其值是一个字符串标识符列表，这些标识符代表该种子所属的“集合”。
例如，一部电视剧可能会将其所有剧集放入 "com.network.seriesname.season1" 集合中。
在大多数情况下，这样做比维护一个相似种子的 info hash 列表要容易得多。属于同一集合的种子可能会共享文件。

‌这些键可以位于 `info` 字典的内部或外部。如果一个键同时存在于 `info` 字典的内部和外部，则其值会被合并。
根据这些提示，客户端可以推断出它已经拥有哪些文件，并重用这些数据。

## 实现

虽然客户端实现背后算法的具体细节超出了本 BEP 的讨论范围，但当客户端尝试重用其他种子中的数据时，内容提供者可以期待一些基本的优化。

- Piece Hash Comparisons (piece 哈希比较)

‌如果两个种子中的 piece 具有相同的哈希值，那么这些 piece 的数据将被重用。这种优化极大地有利于那些 piece-aligned (piece 对齐) 的文件的种子。

- File Name Comparisons (文件名比较)

‌如果两个种子中有同名文件，那么这些文件很可能是相同或非常相似的。客户端应尝试整体或部分重用这些文件。
如果数据被前置、追加、插入、修改或从任意一端截断，客户端仍应尝试从文件中挽救部分数据。

- Info Hash Hint Symmetry (info hash 提示对称性)

‌如果种子 B 提示它可能与种子 A 共享文件，那么种子 A 也可能与种子 B 共享文件。
客户端应当意识到这一点，并且在种子 B 先于种子 A 添加的情况下，客户端应利用种子 B 的提示来进行推断。
换言之，在添加新种子时，应利用所有先前添加的种子所提供的提示。

- Hard Links (硬链接)

‌如果先前下载的种子中的整个文件可以重用，客户端应在支持的系统上使用硬链接，而不是创建文件的副本。

## 原文

https://www.bittorrent.org/beps/bep_0038.html